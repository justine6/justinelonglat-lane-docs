name: Build Docs

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0   # always good practice for tooling & versioning

      - name: Setup Node (if needed for docs build)
        uses: actions/setup-node@v4
        with:
          node-version: 20

      # If your docs require a build step, enable this:
      # - name: Build site
      #   run: npm run build

      - name: Generate sitemap + robots.txt
        shell: pwsh
        run: ./scripts/Invoke-Tool.ps1 -Name gen-sitemap

      - name: Check links in docs (Lychee)
        uses: lycheeverse/lychee-action@v2
        with:
          args: >
            --verbose
            --no-progress
            docs/**/*.html
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
